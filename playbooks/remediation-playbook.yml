---
- name: Fix and verify low disk space on PVC
  hosts: localhost
  gather_facts: no
  tasks:

    - name: Expand PVC to 20Gi
      core.k8s:
        api_version: v1
        kind: PersistentVolumeClaim
        name: test-pvc-01
        namespace: test
        patch:
          spec:
            resources:
              requests:
                storage: \"20Gi\"
        wait: yes
        wait_timeout: 300

    - name: Retrieve PVC status
      core.k8s_facts:
        api_version: v1
        kind: PersistentVolumeClaim
        name: test-pvc-01
        namespace: test
      register: pvc_status

    - name: Verify PVC capacity
      debug:
        msg: \"PVC capacity after expansion: {{ pvc_status.resources[0].status.capacity.storage }}\"