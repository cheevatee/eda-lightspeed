---
- name: Print Alerts and Payload from EDA
  hosts: localhost
  gather_facts: false
  connection: local

  tasks:
    - name: Print the 'alerts' variable
      ansible.builtin.debug:
        msg: "Received 'alerts' data: {{ alerts }}"
      when: alerts is defined

    - name: Print the full 'payload' variable
      ansible.builtin.debug:
        msg: "Received 'payload' data: {{ payload }}"
      when: payload is defined

    - name: "Print each alert (one task per alert)"
      ansible.builtin.debug:
        msg: |
          [ALERT {{ loop.index }}]
          status:     {{ item.status | default('') }}
          alertname:  {{ item.labels.alertname | default('') }}
          severity:   {{ item.labels.severity | default('') }}
          namespace:  {{ item.labels.namespace | default('') }}
          instance:   {{ item.labels.instance | default('') }}
          startsAt:   {{ item.startsAt | default('') }}
          endsAt:     {{ item.endsAt | default('') }}
          summary:    {{ item.annotations.summary | default('') }}
          description: {{ item.annotations.description | default('') }}
          labels:     {{ item.labels | default({}) }}
          annotations: {{ item.annotations | default({}) }}
          -----
      
      # This loops over the 'alerts' variable passed from EDA
      loop: "{{ alerts }}"
      
      # This uses the alert's name in the job log, making it easy to read
      loop_control:
        label: "{{ item.labels.alertname | default('Unnamed Alert') }}"
        
      when: alerts is defined and alerts | length > 0
